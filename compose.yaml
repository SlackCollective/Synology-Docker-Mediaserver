########################### NETWORKS
networks:
  default:
    driver: bridge
  lsio:
    ipam:
      driver: default
      config:
        - subnet: "172.18.0.0/16"
          gateway: "172.18.0.1"
    name: lsio

########################### SERVICES
services:
  ############################# WEBSERVER
  # Swag - webserver, reverse proxy
  swag:
    container_name: swag
    hostname: swag
    image: lscr.io/linuxserver/swag:latest
    cap_add:
      - NET_ADMIN
    restart: unless-stopped
    networks:
      lsio:
    ports:
      - 0.0.0.0:449:443
      - 0.0.0.0:89:80 # simply to allow for http to https redirect
      # - 0.0.0.0:81:81 # for Swag Dashboard
    logging:
      driver: json-file
      options:
        max-file: ${DOCKERLOGGING_MAXFILE}
        max-size: ${DOCKERLOGGING_MAXSIZE}
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
      - URL=${DOMAINNAME}
      - SUBDOMAINS=wildcard
      - VALIDATION=dns
      - DNSPLUGIN=cloudflare
      - CERTPROVIDER=zerossl
      - STAGING=false
      - EMAIL=${CLOUDFLARE_EMAIL}
      - DOCKER_MODS=linuxserver/mods:swag-cloudflare-real-ip|linuxserver/mods:swag-maxmind
      - MAXMINDDB_LICENSE_KEY=${MAXMINDDB_LICENSE_KEY}
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${USERDIR}/swag:/config
      - ${USERDIR}/swag/fail2ban/fail2ban.sqlite3:/dashboard/fail2ban.sqlite3:ro
      # - ${USERDIR}/swag/log:/dashboard/logs:ro
    labels:
      - dozzle
      - org.hotio.pullio.notify=true
      - org.hotio.pullio.update=true
      - org.hotio.pullio.discord.webhook=${DISCORD}
      - org.hotio.pullio.generic.webhook=${PULLIO}

  ############################# CLOUDFLARE DDNS AND SSL
  # Cloudflare DDNS - Dynamic DNS Updater
  cf-ddns:
    container_name: cloudflare-ddns
    hostname: cloudflare-ddns
    image: oznu/cloudflare-ddns
    restart: unless-stopped
    networks:
      lsio:
    logging:
      driver: json-file
      options:
        max-file: ${DOCKERLOGGING_MAXFILE}
        max-size: ${DOCKERLOGGING_MAXSIZE}
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
      - API_KEY=${API_KEY}
      - ZONE=${DOMAINNAME}
      - PROXIED=false
      - RRTYPE=A
      - DELETE_ON_STOP=false
      - DNS_SERVER=1.1.1.1
      - CRON="@daily"
    labels:
      # - dozzle
      - org.hotio.pullio.notify=true
      - org.hotio.pullio.update=true
      - org.hotio.pullio.discord.webhook=${DISCORD}
      - org.hotio.pullio.generic.webhook=${PULLIO}

  ############################# FRONTENDS    
  # Organizr - Unified Frontend
  organizr:
    container_name: organizr
    hostname: organizr
    image: ghcr.io/organizr/organizr
    restart: unless-stopped
    networks:
      lsio:
    ports:
      - 0.0.0.0:88:80
    logging:
      driver: json-file
      options:
        max-file: ${DOCKERLOGGING_MAXFILE}
        max-size: ${DOCKERLOGGING_MAXSIZE}
    environment:
      - fpm="true"
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${USERDIR}/organizr:/config
    labels:
      - dozzle
      - org.hotio.pullio.notify=true
      - org.hotio.pullio.update=true
      - org.hotio.pullio.discord.webhook=${DISCORD}
      - org.hotio.pullio.generic.webhook=${PULLIO}

  ############################# INDEXERS
  # Prowlarr - Hydra and Jackett combined
  prowlarr:
    container_name: prowlarr
    hostname: prowlarr
    image: lscr.io/linuxserver/prowlarr:latest
    restart: unless-stopped
    networks:
      lsio:
    ports:
      - 0.0.0.0:9696:9696
    logging:
      driver: json-file
      options:
        max-file: ${DOCKERLOGGING_MAXFILE}
        max-size: ${DOCKERLOGGING_MAXSIZE}
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
      - UMASK=002
      - ARGS=
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${USERDIR}/prowlarr:/config:rw
    labels:
      - dozzle
      - org.hotio.pullio.notify=true
      - org.hotio.pullio.update=true
      - org.hotio.pullio.discord.webhook=${DISCORD}
      - org.hotio.pullio.generic.webhook=${PULLIO}

  ############################# DOWNLOADERS
  # SABnzbd - nzb downloader
  sabnzbd:
    container_name: sabnzbd
    hostname: sabnzbd
    image: lscr.io/linuxserver/sabnzbd:latest
    restart: unless-stopped
    networks:
      lsio:
    ports:
      - 0.0.0.0:9998:8080
    logging:
      driver: json-file
      options:
        max-file: ${DOCKERLOGGING_MAXFILE}
        max-size: ${DOCKERLOGGING_MAXSIZE}
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
      - HAS_IPV6=false
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${USERDIR}/sabnzbd:/config
      - ${DATADIR}/usenet:/data/usenet:rw
    labels:
      - dozzle
      - org.hotio.pullio.notify=true
      - org.hotio.pullio.update=true
      - org.hotio.pullio.discord.webhook=${DISCORD}
      - org.hotio.pullio.generic.webhook=${PULLIO}

  # qbittorrent - torrent downloader with VPN
  qbittorrent:
    container_name: qbittorrent
    hostname: qbittorrent
    image: cr.hotio.dev/hotio/qbittorrent
    # cap_add:
      # - NET_ADMIN
    privileged: true
    sysctls:
      - net.ipv4.conf.all.src_valid_mark=1
      - net.ipv6.conf.all.disable_ipv6=1
    restart: unless-stopped
    networks:
      lsio:
    ports:
      - 0.0.0.0:9997:8080
      - 0.0.0.0:65523:65523
      # - 0.0.0.0:8118:8118 #for socket proxy
    dns:
      - 1.1.1.1
      - 8.8.8.8
    logging:
      driver: json-file
      options:
        max-file: ${DOCKERLOGGING_MAXFILE}
        max-size: ${DOCKERLOGGING_MAXSIZE}
    devices: # Optional, uncomment if you use VPN
      - /dev/net/tun:/dev/net/tun # Optional, uncomment if you use VPN
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
      - UMASK=022
      - VPN_ENABLED=true # true or false
      # - VPN_LAN_NETWORK=172.18.0.12/16,192.168.1.0/24 #<lan ipv4 network>/<cidr notation>
      - VPN_CONF=wg0
      - PRIVOXY_ENABLED=false # or true
      # - WEBUI_PORTS=9997/tcp,9997/udp # only needed if you don't use default ports
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${USERDIR}/qbittorrent:/config:rw
      - ${DATADIR}/torrents:/data/torrents:rw
    labels:
      - dozzle
      - org.hotio.pullio.notify=true
      - org.hotio.pullio.update=true
      - org.hotio.pullio.discord.webhook=${DISCORD}
      - org.hotio.pullio.generic.webhook=${PULLIO}

  # qbit_manage - torrent client management
  qbit_manage:
    container_name: qbitmanage
    hostname: qbitmanage
    image: bobokun/qbit_manage
    restart: unless-stopped
    networks:
      lsio:
    logging:
      driver: json-file
      options:
        max-file: ${DOCKERLOGGING_MAXFILE}
        max-size: ${DOCKERLOGGING_MAXSIZE}
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - UMASK=022
      - TZ=${TZ}
      - QBT_RUN=false
      - QBT_SCHEDULE=1440
      - QBT_CONFIG=config.yml
      - QBT_LOGFILE=activity.log
      - QBT_CROSS_SEED=false
      - QBT_RECHECK=false
      - QBT_CAT_UPDATE=false
      - QBT_TAG_UPDATE=true
      - QBT_REM_UNREGISTERED=false
      - QBT_REM_ORPHANED=true
      - QBT_TAG_TRACKER_ERROR=false
      - QBT_TAG_NOHARDLINKS=false
      - QBT_SHARE_LIMITS=false
      - QBT_SKIP_CLEANUP=false
      - QBT_DRY_RUN=false
      - QBT_LOG_LEVEL=ERROR
      - QBT_DIVIDER==
      - QBT_WIDTH=100
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${USERDIR}/qbitmanage:/config
      - ${USERDIR}/qbittorrent/data/BT_backup:/qbit_appdata # modify if needed
      - ${DATADIR}/torrents:/data/torrents # modify if needed
    labels:
      # - dozzle
      - org.hotio.pullio.notify=true
      - org.hotio.pullio.update=true
      - org.hotio.pullio.discord.webhook=${DISCORD}
      - org.hotio.pullio.generic.webhook=${PULLIO}
      
  # autobrr - torrent RSS downloader
  autobrr:
    container_name: autobrr
    hostname: autobrr
    image: ghcr.io/autobrr/autobrr:latest
    restart: unless-stopped
    networks:
      lsio:
    ports:
      - 0.0.0.0:7474:7474
    logging:
      driver: json-file
      options:
        max-file: ${DOCKERLOGGING_MAXFILE}
        max-size: ${DOCKERLOGGING_MAXSIZE}
    environment:
      - TZ=${TZ}
      - AUTOBRR_PORT=7474
      - AUTOBRR_HOST=0.0.0.0
    user: ${PUID}:${PGID}
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${USERDIR}/autobrr:/config
    labels:
      # - dozzle
      - org.hotio.pullio.notify=true
      - org.hotio.pullio.update=true
      - org.hotio.pullio.discord.webhook=${DISCORD}
      - org.hotio.pullio.generic.webhook=${PULLIO}

  # omegabrr - auto-generate filters for autobrr based on *arr subscriptions
  omegabrr:
    container_name: omegabrr
    hostname: omegabrr
    image: ghcr.io/autobrr/omegabrr:latest
    restart: unless-stopped
    networks:
      lsio:
    ports:
      - 0.0.0.0:7441:7441
    logging:
      driver: json-file
      options:
        max-file: ${DOCKERLOGGING_MAXFILE}
        max-size: ${DOCKERLOGGING_MAXSIZE}
    environment:
      - TZ=${TZ}
    user: ${PUID}:${PGID}
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${USERDIR}/omegabrr:/config
    labels:
      # - dozzle
      - org.hotio.pullio.notify=true
      - org.hotio.pullio.update=true
      - org.hotio.pullio.discord.webhook=${DISCORD}
      - org.hotio.pullio.generic.webhook=${PULLIO}

  ############################# MEDIA SEARCH/INDEX
  # Radarr - Movies
  radarr:
    container_name: radarr
    hostname: radarr
    image: lscr.io/linuxserver/radarr:latest
    restart: unless-stopped
    networks:
      lsio:
    ports:
      - 0.0.0.0:7878:7878
    logging:
      driver: json-file
      options:
        max-file: ${DOCKERLOGGING_MAXFILE}
        max-size: ${DOCKERLOGGING_MAXSIZE}
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${USERDIR}/radarr:/config
      - ${DATADIR}:/data
    labels:
      - dozzle
      - org.hotio.pullio.notify=true
      - org.hotio.pullio.update=true
      - org.hotio.pullio.discord.webhook=${DISCORD}
      - org.hotio.pullio.generic.webhook=${PULLIO}

  # Sonarr - TV
  sonarr:
    container_name: sonarr
    hostname: sonarr
    image: lscr.io/linuxserver/sonarr:develop
    restart: unless-stopped
    networks:
      lsio:
    ports:
      - 0.0.0.0:8989:8989
    logging:
      driver: json-file
      options:
        max-file: ${DOCKERLOGGING_MAXFILE}
        max-size: ${DOCKERLOGGING_MAXSIZE}
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${USERDIR}/sonarr:/config
      - ${DATADIR}:/data
    labels:
      - dozzle
      - org.hotio.pullio.notify=true
      - org.hotio.pullio.update=true
      - org.hotio.pullio.discord.webhook=${DISCORD}
      - org.hotio.pullio.generic.webhook=${PULLIO}

  # Bazarr – Subtitle Management
  bazarr:
    container_name: bazarr
    hostname: bazarr
    image: lscr.io/linuxserver/bazarr:latest
    restart: unless-stopped
    networks:
      lsio:
    ports:
      - 0.0.0.0:6767:6767
    logging:
      driver: json-file
      options:
        max-file: ${DOCKERLOGGING_MAXFILE}
        max-size: ${DOCKERLOGGING_MAXSIZE}
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${USERDIR}/bazarr:/config
      - ${DATADIR}/media:/data/media
    labels:
      - dozzle
      - org.hotio.pullio.notify=true
      - org.hotio.pullio.update=true
      - org.hotio.pullio.discord.webhook=${DISCORD}
      - org.hotio.pullio.generic.webhook=${PULLIO}

  # Tdarr - Video conversion
  tdarr:
    container_name: tdarr
    hostname: tdarr
    image: haveagitgat/tdarr
    privileged: true
    restart: unless-stopped
    networks:
      lsio:
    ports:
      - 0.0.0.0:8265:8265
      - 0.0.0.0:8266:8266
    logging:
      driver: json-file
      options:
        max-file: ${DOCKERLOGGING_MAXFILE}
        max-size: ${DOCKERLOGGING_MAXSIZE}
    devices: # these are optional (used if Syno has Intel CPU, for HW transcoding)
      - /dev/dri:/dev/dri
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
      - serverIP=172.18.0.1
      - serverPort=8266
      - webUIPort=8265
      - internalNode=true
      - nodeID=TdarrNode
      - NVIDIA_DRIVER_CAPABILITIES=all
      - NVIDIA_VISIBLE_DEVICES=all
      - THREADS_WORKER_INIT_TIMEOUT=200000
      - gpus=all
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${USERDIR}:/app/server
      - ${USERDIR}/Tdarr/Configs:/app/configs
      - ${USERDIR}/Tdarr/Logs:/app/logs
      - ${DATADIR}/media/Transcode:/temp
      - ${DATADIR}:/data
    labels:
      - dozzle
      - org.hotio.pullio.notify=true
      - org.hotio.pullio.update=true
      - org.hotio.pullio.discord.webhook=${DISCORD}
      - org.hotio.pullio.generic.webhook=${PULLIO}

  ############################# HOME THEATRE
  # Plex - Media Player
  plex:
    container_name: plex
    hostname: plex
    image: lscr.io/linuxserver/plex:latest
    restart: unless-stopped
    network_mode: "host"
    logging:
      driver: json-file
      options:
        max-file: ${DOCKERLOGGING_MAXFILE}
        max-size: ${DOCKERLOGGING_MAXSIZE}
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
      - VERSION=docker
      - PLEX_PASS=${PLEX_PASS}
      - HOSTNAME=plex.${DOMAINNAME}
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${USERDIR}/plex:/config:rw
      - ${DATADIR}/media:/data/media:rw
      - ${DATADIR}/media:/transcode
    devices:
      - /dev/dri:/dev/dri
    labels:
      - dozzle
      - org.hotio.pullio.notify=true
      - org.hotio.pullio.update=true
      - org.hotio.pullio.discord.webhook=${DISCORD}
      - org.hotio.pullio.generic.webhook=${PULLIO}

  ############################# PLEX MONITORING/MANAGEMENT
  # Tautulli - Media play and user monitoring
  tautulli:
    container_name: tautulli
    hostname: tautulli
    image: lscr.io/linuxserver/tautulli:latest
    restart: unless-stopped
    networks:
      lsio:
    ports:
      - 0.0.0.0:8181:8181
    logging:
      driver: json-file
      options:
        max-file: ${DOCKERLOGGING_MAXFILE}
        max-size: ${DOCKERLOGGING_MAXSIZE}
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
      - UMASK=002
      - ARGS=
      - DEBUG=no
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${USERDIR}/tautulli:/config:rw
      - ${USERDIR}/plex:/plex:ro
    labels:
      # - dozzle
      - org.hotio.pullio.notify=true
      - org.hotio.pullio.update=true
      - org.hotio.pullio.discord.webhook=${DISCORD}
      - org.hotio.pullio.generic.webhook=${PULLIO}

  # Overseer - Allows Plex users to request media
  overseerr:
    container_name: overseerr
    hostname: overseerr
    image: lscr.io/linuxserver/overseerr:latest
    restart: unless-stopped
    networks:
      lsio:
    ports:
      - 0.0.0.0:5055:5055
    logging:
      driver: json-file
      options:
        max-file: ${DOCKERLOGGING_MAXFILE}
        max-size: ${DOCKERLOGGING_MAXSIZE}
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${USERDIR}/overseerr:/config
      - ${DATADIR}/media:/data/media
    labels:
      # - dozzle
      - org.hotio.pullio.notify=true
      - org.hotio.pullio.update=true
      - org.hotio.pullio.discord.webhook=${DISCORD}
      - org.hotio.pullio.generic.webhook=${PULLIO}

  ############################# BOOK LIBRARY MANAGEMENT
  # Calibre – Content server
  calibre:
    container_name: calibre
    hostname: calibre
    image: lscr.io/linuxserver/calibre:latest
    security_opt:
      - seccomp:unconfined
    restart: unless-stopped
    networks:
      lsio:
    ports:
      - 0.0.0.0:8082:8080
      - 0.0.0.0:8083:8081
    logging:
      driver: json-file
      options:
        max-file: ${DOCKERLOGGING_MAXFILE}
        max-size: ${DOCKERLOGGING_MAXSIZE}
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
      - HAS_IPV6=false
      - DRINODE=/dev/dri/renderD128
      - TITLE=BrunswickBooks
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${USERDIR}/calibre:/config
      - ${DATADIR}:/data
      - ${DATADIR}/media/books/imports:/imports
    devices:
      - /dev/dri:/dev/dri
    labels:
      - dozzle
      - org.hotio.pullio.notify=true
      - org.hotio.pullio.update=true
      - org.hotio.pullio.discord.webhook=${DISCORD}
      - org.hotio.pullio.generic.webhook=${PULLIO}

  ############################# SYSTEM MANAGEMENT/MONITORING  
  # Dozzle - Real-time Docker Log Viewer
  dozzle:
    container_name: dozzle
    hostname: dozzle
    image: amir20/dozzle
    restart: unless-stopped
    networks:
      lsio:
    ports:
      - 0.0.0.0:9999:8080
    logging:
      driver: json-file
      options:
        max-file: ${DOCKERLOGGING_MAXFILE}
        max-size: ${DOCKERLOGGING_MAXSIZE}
    environment:
      - DOZZLE_BASE=/
      - DOZZLE_LEVEL=error
      - DOZZLE_FILTER="label=dozzle" # limits logging to containers with this label
      - DOZZLE_TAILSIZE=300
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - /var/run/docker.sock:/var/run/docker.sock
    labels:
      # - dozzle
      - org.hotio.pullio.notify=true
      - org.hotio.pullio.update=true
      - org.hotio.pullio.discord.webhook=${DISCORD}
      - org.hotio.pullio.generic.webhook=${PULLIO}

  # Notifiarr - update ARR profiles
  notifiarr:
    container_name: notifiarr
    hostname: ${HOSTNAME}
    image: golift/notifiarr:latest
    restart: unless-stopped
    networks:
      lsio:
    ports:
      - 0.0.0.0:5454:5454
    logging:
      driver: json-file
      options:
        max-file: ${DOCKERLOGGING_MAXFILE}
        max-size: ${DOCKERLOGGING_MAXSIZE}
    environment:
      - TZ=${TZ}
      - DN_API_KEY=${NOTIFIARR}
      - USER=docker
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${USERDIR}/notifiarr:/config
    labels:
      # - dozzle
      - org.hotio.pullio.notify=true
      - org.hotio.pullio.update=true
      - org.hotio.pullio.discord.webhook=${DISCORD}
      - org.hotio.pullio.generic.webhook=${PULLIO}

  ############################# SECURITY/PASSWORD MANAGEMENT
  # Vaultwarden - Locally-hosted Bitwarden
  vaultwarden:
    container_name: vaultwarden
    hostname: vaultwarden
    image: vaultwarden/server:latest
    restart: unless-stopped
    networks:
      lsio:
    ports:
      - 0.0.0.0:8269:80
    logging:
      driver: json-file
      options:
        max-file: ${DOCKERLOGGING_MAXFILE}
        max-size: ${DOCKERLOGGING_MAXSIZE}
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
      - DOMAIN="https://vaultwarden.${DOMAINNAME}"
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${VAULTDIR}:/data
    labels:
      - dozzle
      - org.hotio.pullio.notify=true
      - org.hotio.pullio.update=true
      - org.hotio.pullio.discord.webhook=${DISCORD}
      - org.hotio.pullio.generic.webhook=${PULLIO}
